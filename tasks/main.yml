---
# tasks file for ansible-nameserver

- name: ansible-nameserver | install
  include_tasks: install_platform.yml
  when: >
    (
    bind_masters_group in group_names
    ) or
    (
    bind_slaves_group in group_names
    )

- name: ansible-nameserver | host entries
  include_tasks: host_entries.yml

- name: ansible-nameserver | bind server configuration
  include_tasks: config_bind.yml
  when: >
    (
    (
    bind_masters_group in group_names
    ) or
    (
    bind_slaves_group in group_names
    )
    ) and
    bind_config

- name: ansible-nameserver | bind server zone configuration
  include_tasks: manage_zones.yml
  when: >
    (
    bind_masters_group in group_names
    ) or
    (
    bind_slaves_group in group_names
    )
    and
    bind_manage_zones

- name: ansible-nameserver | install
  include_tasks: install.yml
  when: >
    (
    bind_masters_group in group_names
    ) or
    (
    bind_slaves_group in group_names
    )

- name: ansible-nameserver | dns client configuration
  include_tasks: dns_client.yml
  when: bind_clients in group_names


- name: ansible-nameserver | debug idm_client_group
  debug:
    var: group_names
    verbosity: 2

- name: ansible-nameserver | debug skip_ipa_value
  debug:
    var: skip_ipa
    verbosity: 2
  when:
    - skip_ipa is defined

- name: ansible-nameserver | ensure dns for IPA clients
  include_tasks: ipa_dns_client.yml
  when:
   - idm_client_group in group_names
   - not skip_ipa is defined or not skip_ipa
